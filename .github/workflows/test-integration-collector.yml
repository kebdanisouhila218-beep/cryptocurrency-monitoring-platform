name: Integration Test - Collector

on: [push, pull_request]

jobs:
  test-collector-integration:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Start MongoDB
        run: |
          docker compose up -d mongo
          sleep 10

      - name: Run integration test
        run: |
          docker run --network cryptocurrency-monitoring-platform_default \
                     --volume "$(pwd)/collector:/app" \
                     --workdir /app \
                     python:3.11-slim \
                     sh -c "
                       pip install pytest pymongo requests &&
                       python -m pytest test_integration_collector.py -v
                     "

      - name: Cleanup
        if: always()
        run: |
          docker compose down -v